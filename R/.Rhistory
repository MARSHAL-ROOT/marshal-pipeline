results<- NULL
k <- 1
# ------------------------------------------------
# Computing the root system hydraulic architecture
# ------------------------------------------------
# Total of simulation that will be initiate
all <- length(unique(all_roots$rep)) * length(unique(conductivities$scenario)) *
length(unique(all_roots$age)) * length(unique(all_roots$ex)) *
length(unique(soil$humid))
# pb = txtProgressBar(min = 0, max = all, initial = 0, style = 3)
# Loop to run MARSHAL with the selected simulation parameters.
for(exa in unique(all_roots$ex)){# Example of RSA
for(re in unique(all_roots$rep)){ # repetition
for(ag in sort(as.numeric(unique(all_roots$age)))){# age of the RS
for(sen in unique(conductivities$scenario)){ # hydraulic properties
for(hum in unique(soil$humid)){ # Scenario of water potential in the soil
# Progression bar
# setTxtProgressBar(pb,k)
# Select specific Soil for the simulation
temp_soil <- soil %>%
filter(value == ag,
humid == hum)%>%
select(-value, -humid)
# Select specific root system for the simulation
temp_root <- all_roots %>%
filter(age == ag,
rep == re,
ex == exa)%>%
as.tibble()%>%
select(-ex)
# Select specific conductivities
temp_conduct <- conductivities%>%
filter(scenario == sen)%>%
select(-scenario)
# -----------------------------
# Run MARSHAL
# -----------------------------
hydraulics <- getSUF(temp_root,
temp_conduct,
temp_soil,
hetero = T,
Psi_collar = tpots)
# Aggregate output from MARSHAL
results <- rbind(results, data.frame(krs = hydraulics$krs,
tact = hydraulics$tact,
tpot = hydraulics$tpot,
tp = tpots,
scenario = sen,
age = ag,
rep = re,
ex = exa,
humid = hum,
simulation = k))
# Keep the information about the very detail hydrological parameter on
# all the root segment only for one repetion of the plant per simulation.
if(re >= nrep-1){
# Format dataset to be compatible with MARSHAL output
first <- temp_root[temp_root$node1ID == 0,]
nodals_ids <- unique(temp_root$branchID[temp_root$type == 4 |
temp_root$type == 5])
for(no in nodals_ids){
temp <- temp_root%>%
filter(branchID == no)
temp <- temp[1,]
connection <- data.frame(node1ID = 0,
node2ID = temp$node1ID,
branchID = temp$branchID,
x1 = first$x1, y1 = first$y1, z1 = first$z1,
x2 = temp$x1, y2 = temp$y1, z2 = temp$z1,
radius = temp$radius,
length = sqrt((first$x1-temp$x1)^2 +
(first$y1-temp$y1)^2 +
(first$z1-temp$z1)^2 ),
R = 0, G = 0, B = 0,
time = temp$time,
type = temp$type,
age = temp$age,
rep = temp$rep)
new_table = rbind(temp_root, connection)
temp_root = new_table
}
temp_root <- temp_root[order(temp_root$node2ID, decreasing = F),]
# Merge output of MARSHAL on specific root segment
temp_root$suf <- as.vector(hydraulics$suf)
temp_root$suf1 <- as.vector(hydraulics$suf1)
temp_root$kx <- as.vector(hydraulics$kx)
temp_root$kr <- as.vector(hydraulics$kr)
temp_root$jr <- as.vector(hydraulics$jr)
temp_root$psi <- as.vector(hydraulics$psi)
temp_root$jxl <- as.vector(hydraulics$jxl)
temp_root$psi_soil <- as.vector(hydraulics$psi_soil)
# Add the simulation specificity to the dataset
temp_root$scenario <- sen
temp_root$ex <- exa
temp_root$humid <- hum
temp_root$rep <- re
new_all_roots <- rbind(new_all_roots, temp_root)
}
k <- k + 1
}
}
}
}
}
# Save the results
# write_csv(new_all_roots, "new_all_roots.csv")
# new_all_roots <- read.csv("new_all_roots.csv")
# For the two repetions on which we have values on each segment,
# we take the mean values of the sum of each variables.
dens <- new_all_roots%>%
mutate(age = as.numeric(age))%>%
group_by(type, age, rz1 = round(z1/2)*2, # on every two cm of the profile
scenario, ex, humid)%>%
summarise(root = sum(length)/2, # The mean of the sum on the two repetitions
su = sum(suf)/2,
su1 = sum(suf1)/2,
j = sum(jr)/2,
jx = sum(jxl)/2,
p = sum(psi)/2,
kr = sum(kr)/2)
dens%>%
filter(age == 60,
scenario == min(scenario),
humid == min(humid))%>%
ggplot(aes(rz1, root, colour=factor(type))) +
geom_line(alpha = 0.5) +
geom_smooth(se=F) +
theme_classic()+
coord_flip() +
xlab("depth (cm)") +
ylab("length (cm)")+
facet_wrap(~ex, labeller = as_labeller(babbel))+
labs(colour = "Root type")
dens%>%
filter(ex == unique(dens$ex)[1],
scenario == 1,
age > 10)%>%
ggplot(aes(rz1, su1, colour=factor(type)))+
geom_line(alpha = 0.8) +
#geom_smooth(se=F, alpha = 0.1) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("Standard uptake fraction (-)")+
#labs(colour = "Root type")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(~age, labeller = as_labeller(babbel))
dens%>%
filter(ex == unique(dens$ex)[1],
scenario == 1,
age > 10)%>%
ggplot(aes(rz1, su1, colour=factor(type)))+
geom_line(alpha = 0.8) +
#geom_smooth(se=F, alpha = 0.1) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("Standard uptake fraction (-)")+
#labs(colour = "Root type")+
theme(axis.text.x=element_text(angle=90)) +
facet_wrap(~age, labeller = as_labeller(babbel))
dens%>%
filter(ex == unique(dens$ex)[1],
scenario == 1,
age > 10)%>%
ggplot(aes(rz1, su1, colour=factor(type)))+
geom_line(alpha = 0.8) +
#geom_smooth(se=F, alpha = 0.1) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("Standard uptake fraction (-)")+
#labs(colour = "Root type")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(~age, labeller = as_labeller(babbel))
dens%>%
filter(ex == unique(dens$ex)[2],
scenario == 1,
age > 10)%>%
ggplot(aes(rz1, su1, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F, alpha = 0.1) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("Standard uptake fraction (-)")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(~age)
dens%>%
filter(ex == unique(dens$ex)[3],
scenario == 1,
age > 10)%>%
ggplot(aes(rz1, su1, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F, alpha = 0.1, method = "gam") +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("Standard uptake fraction (-)")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(~age)
dens%>%
filter(ex == unique(dens$ex)[3],
scenario == 1,
age > 20)%>%
ggplot(aes(rz1, su1, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F, alpha = 0.1, method = "gam") +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("Standard uptake fraction (-)")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(~age)
dens%>%
filter(age == 60,
scenario == 1
#,ex == unique(dens$ex)[1]
)%>%
ggplot(aes(rz1, j, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("Radial fluxes (cm³/j)")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(ex~humid,  scales = "free", labeller = as_labeller(babbel))
dens%>%
filter(age == 40,
scenario == 1)%>%
ggplot(aes(rz1, jx, colour=factor(type))) +
geom_line(alpha = 0.7) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("Axial fluxes (cm³/j)")+
facet_grid(ex~humid, scales = "free", labeller = as_labeller(babbel))
dens%>%
filter(age == 50,
humid == unique(dens$humid)[3],
scenario == 2)%>%
ggplot(aes(rz1, p, colour=factor(type))) +
geom_line(alpha = 0.5) +
geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("psi (hPa)")+
theme(axis.text.x=element_text(angle=90)) +
facet_wrap(~ex, labeller = as_labeller(babbel))
dens%>%
filter(age == 50,
humid == unique(dens$humid)[3],
scenario == 2)%>%
ggplot(aes(rz1, p, colour=factor(type))) +
geom_line(alpha = 0.5) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("psi (hPa)")+
theme(axis.text.x=element_text(angle=90)) +
facet_wrap(~ex, labeller = as_labeller(babbel))
dens%>%
filter(age == 50,
humid == unique(dens$humid)[3],
scenario == 2)%>%
ggplot(aes(rz1, p, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("psi (hPa)")+
theme(axis.text.x=element_text(angle=90)) +
facet_wrap(~ex, labeller = as_labeller(babbel))
unique(dens$humid)[3]
dens%>%
filter(age == 50,
humid == unique(dens$humid)[1],
scenario == 2)%>%
ggplot(aes(rz1, p, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("psi (hPa)")+
theme(axis.text.x=element_text(angle=90)) +
facet_wrap(~ex, labeller = as_labeller(babbel))
dens%>%
filter(age == 50,
scenario == 2)%>%
ggplot(aes(rz1, p, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("psi (hPa)")+
theme(axis.text.x=element_text(angle=90)) +
facet_wrap(humid~ex, labeller = as_labeller(babbel))
dens%>%
filter(age == 50,
scenario == 2)%>%
ggplot(aes(rz1, p, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("psi (hPa)")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(humid~ex, labeller = as_labeller(babbel))
dens%>%
filter(age == 50,
scenario == 2)%>%
ggplot(aes(rz1, p, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("psi (hPa)")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(humid~ex, labeller = as_labeller(babbel), scales = "free")
dens%>%
filter(age == 50,
scenario == 2)%>%
ggplot(aes(rz1, p, colour=factor(type))) +
geom_line(alpha = 0.8) +
#geom_smooth(se=F) +
coord_flip() +
theme_classic()+
xlab("Depth (cm)") +
ylab("psi (hPa)")+
theme(axis.text.x=element_text(angle=90)) +
facet_grid(humid~ex, labeller = as_labeller(babbel))
Transpiration<- results%>%
mutate(humid = as.character(humid))%>%
group_by(age, rep, scenario, humid, ex)%>%
summarise(Tpot = max(tpot, tact),
Tact = min(tpot, tact))
Transpiration%>%
filter(humid == "-300")%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2, alpha = 0.5)+
geom_smooth(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.01)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "Root architecture example")+  labs(colour = "Root architecture example",
shape = "scenario",
linetype = "scenario")+
#guides(linetype = F)+
facet_wrap(~humid, scales = "free", labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2, alpha = 0.5)+
geom_line(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.8)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "Root architecture example")+  labs(colour = "Root architecture example",
shape = "scenario",
linetype = "scenario")+
facet_grid(~humid, labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario, rep)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2, alpha = 0.5)+
geom_line(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.8)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "Root architecture example")+  labs(colour = "Root architecture example",
shape = "scenario",
linetype = "scenario")+
facet_grid(~humid, labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario, rep)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2, alpha = 0.5)+
geom_smooth(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.8, se = F)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "Root architecture example")+  labs(colour = "Root architecture example",
shape = "scenario",
linetype = "scenario")+
facet_grid(~humid, labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario, rep)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2, alpha = 0.2)+
geom_smooth(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.8, se = F)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "Root architecture example")+  labs(colour = "Root architecture example",
shape = "scenario",
linetype = "scenario")+
facet_grid(~humid, labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario, rep)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 3, alpha = 0.2)+
geom_smooth(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.8, se = F)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "Root architecture example")+  labs(colour = "Root architecture example",
shape = "scenario",
linetype = "scenario")+
facet_grid(~humid, labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario, rep)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2.5, alpha = 0.4)+
geom_smooth(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.8, se = F)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "Root architecture example")+  labs(colour = "Root architecture example",
shape = "scenario",
linetype = "scenario")+
facet_grid(~humid, labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario, rep)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2.5, alpha = 0.4)+
geom_smooth(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.5, se = F)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "Root architecture example")+  labs(colour = "Root architecture example",
shape = "scenario",
linetype = "scenario")+
facet_grid(~humid, labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario, rep)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2.5, alpha = 0.4)+
geom_smooth(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.5, se = F)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "RSA example")+  labs(colour = "RSA example",
shape = "scenario",
linetype = "scenario")+
facet_grid(~humid, labeller = as_labeller(babbel))
Transpiration%>%
filter(humid %in% c("-7000", "-15000"))%>%
group_by(ex, humid, age, scenario, rep)%>%
summarise(Tact = mean(Tact),
Tpot = mean(Tpot))%>%
ggplot(aes(x= age, y = Tact, colour = factor(ex)))+
geom_point(aes(shape = factor(scenario)),size = 2.5, alpha = 0.4)+
geom_smooth(aes(x = age, y = Tpot, colour = factor(ex),
linetype = factor(scenario)), alpha = 0.5, se = F)+
geom_hline(yintercept = 0)+
theme_classic()+
xlab("Time (d)") +
ylab("Actual transpiration")+
labs(colour = "RSA example")+  labs(colour = "RSA example",
shape = "scenario",
linetype = "scenario")+
facet_wrap(~humid, labeller = as_labeller(babbel))
